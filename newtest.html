<!DOCTYPE html>
<html>

<head>
    <link rel="manifest" href="./manifest.json">
    <script src="./sw.js" referrerpolicy="no-referrer"></script>
    <!-- PWA -->
    <link rel="manifest" href="./manifest.json">
    <style>
        .commonPadding {
            padding-left: 10px;
        }
    </style>
</head>

<body>
    <div class="commonPadding">
        <h2>
            7. Redirecting to download if App is not installed
        </h2>
        <button data-testid="ifAppInstalledTestBtn" onClick="test();">com.salesforce.fieldservice://; Native
            App</button>
    </div>
    <input type="text" value="" id="appUri" />
</body>

<script>
    const OPEN_APP_TIMEOUT = 6000; // Set timeout to 2 seconds

    function test() {
        // Trigger the native app to open here
        const customUri = document.getElementById('appUri').value || 'svmxgo://';
        const webURL = "https://www.google.com/"

        // window.location = customUri;
        window.location = customUri;

        setTimeout(function () {
            // Check the visibility state of the page
            if (document.visibilityState === "hidden") {
                // The page is currently hidden, which may indicate that the user has switched to a native app
                // Listen for the blur event on the window to detect when the browser window loses focus
                window.addEventListener("blur", function (event) {
                    // When the window loses focus, check the visibility state again to confirm that the page is hidden
                    if (document.visibilityState === "hidden") {
                        // The page is hidden, so the user may have switched to a native app
                        // Handle the native app switch here
                        console.log("User switched to native app");
                    }
                });
            }
            else {
                // The page is currently visible
                // Listen for the focus event on the window to detect when the browser window regains focus
                window.addEventListener("focus", function (event) {
                    // When the window regains focus, check the visibility state again to confirm that the page is visible
                    if (document.visibilityState === "visible") {
                        // The page is visible again, so the user may have returned from a native app
                        // Handle the return from native app here
                        console.log("User returned from native app");
                    }
                });
            }

        }, 10000);
    }


    // function test() {
    //     const customUri = document.getElementById('appUri').value || 'svmxgo://';

    //     window.open(customUri, '_self', 'noopener, noreferrer');

    //     setTimeout(function () {
    //         alert(document.visibilityState)
    //     }, 5000)
    // }
    // function handleBlur() {
    //     console.log('Native app may have been opened');
    //     window.removeEventListener('blur', handleBlur);
    //     document.removeEventListener('visibilitychange', handleVisibilityChange);
    // }

    // function handleVisibilityChange() {
    //     if (document.visibilityState === 'visible') {
    //         console.log('Error message was shown');
    //         window.removeEventListener('blur', handleBlur);
    //         document.removeEventListener('visibilitychange', handleVisibilityChange);
    //     }
    // }

    // window.addEventListener('blur', handleBlur);
    // document.addEventListener('visibilitychange', handleVisibilityChange);

</script>

</html>